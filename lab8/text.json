{
    "content": "```json\n{\n  \"analysis\": \"Creating a comprehensive hospital management database requires careful design to handle various aspects including patient records, staff management, appointments, medical records, billing, inventory, and more. Since no specific database type was mentioned, I'll provide a design that works well with most relational databases (MySQL, PostgreSQL, SQL Server) with notes for specific optimizations.\",\n  \"optimized_query\": \"-- Core Tables for Hospital Management System\\n\\n-- 1. Users table (base for all system users)\\nCREATE TABLE users (\\n    user_id INT PRIMARY KEY AUTO_INCREMENT,\\n    username VARCHAR(50) UNIQUE NOT NULL,\\n    password_hash VARCHAR(255) NOT NULL,\\n    email VARCHAR(100) UNIQUE NOT NULL,\\n    phone VARCHAR(20),\\n    user_type ENUM('admin', 'doctor', 'nurse', 'receptionist', 'pharmacist', 'lab_technician', 'patient') NOT NULL,\\n    is_active BOOLEAN DEFAULT TRUE,\\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\\n    INDEX idx_user_type (user_type),\\n    INDEX idx_email (email)\\n);\\n\\n-- 2. Patients table\\nCREATE TABLE patients (\\n    patient_id INT PRIMARY KEY AUTO_INCREMENT,\\n    user_id INT UNIQUE,\\n    mrn VARCHAR(20) UNIQUE NOT NULL, -- Medical Record Number\\n    first_name VARCHAR(50) NOT NULL,\\n    last_name VARCHAR(50) NOT NULL,\\n    date_of_birth DATE NOT NULL,\\n    gender ENUM('M', 'F', 'Other') NOT NULL,\\n    blood_group VARCHAR(5),\\n    address TEXT,\\n    emergency_contact VARCHAR(100),\\n    emergency_phone VARCHAR(20),\\n    insurance_id VARCHAR(50),\\n    allergies TEXT,\\n    chronic_conditions TEXT,\\n    registration_date DATE DEFAULT (CURRENT_DATE),\\n    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE SET NULL,\\n    INDEX idx_mrn (mrn),\\n    INDEX idx_name (last_name, first_name),\\n    INDEX idx_dob (date_of_birth)\\n);\\n\\n-- 3. Staff table\\nCREATE TABLE staff (\\n    staff_id INT PRIMARY KEY AUTO_INCREMENT,\\n    user_id INT UNIQUE NOT NULL,\\n    employee_id VARCHAR(20) UNIQUE NOT NULL,\\n    first_name VARCHAR(50) NOT NULL,\\n    last_name VARCHAR(50) NOT NULL,\\n    department_id INT,\\n    specialization VARCHAR(100),\\n    qualification TEXT,\\n    joining_date DATE NOT NULL,\\n    salary DECIMAL(10,2),\\n    shift_timing VARCHAR(50),\\n    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,\\n    INDEX idx_employee_id (employee_id),\\n    INDEX idx_department (department_id)\\n);\\n\\n-- 4. Departments table\\nCREATE TABLE departments (\\n    department_id INT PRIMARY KEY AUTO_INCREMENT,\\n    department_name VARCHAR(100) UNIQUE NOT NULL,\\n    department_head INT,\\n    location VARCHAR(100),\\n    phone VARCHAR(20),\\n    FOREIGN KEY (department_head) REFERENCES staff(staff_id) ON DELETE SET NULL\\n);\\n\\n-- Add foreign key for department in staff table\\nALTER TABLE staff \\nADD CONSTRAINT fk_staff_department \\nFOREIGN KEY (department_id) REFERENCES departments(department_id) ON DELETE SET NULL;\\n\\n-- 5. Appointments table\\nCREATE TABLE appointments (\\n    appointment_id INT PRIMARY KEY AUTO_INCREMENT,\\n    patient_id INT NOT NULL,\\n    doctor_id INT NOT NULL,\\n    appointment_date DATE NOT NULL,\\n    appointment_time TIME NOT NULL,\\n    status ENUM('scheduled', 'completed', 'cancelled', 'no-show') DEFAULT 'scheduled',\\n    reason_for_visit TEXT,\\n    notes TEXT,\\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\\n    FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE,\\n    FOREIGN KEY (doctor_id) REFERENCES staff(staff_id) ON DELETE CASCADE,\\n    INDEX idx_date_time (appointment_date, appointment_time),\\n    INDEX idx_patient_appointments (patient_id, appointment_date),\\n    INDEX idx_doctor_appointments (doctor_id, appointment_date),\\n    UNIQUE KEY unique_appointment (doctor_id, appointment_date, appointment_time)\\n);\\n\\n-- 6. Medical Records table\\nCREATE TABLE medical_records (\\n    record_id INT PRIMARY KEY AUTO_INCREMENT,\\n    patient_id INT NOT NULL,\\n    doctor_id INT NOT NULL,\\n    appointment_id INT,\\n    visit_date DATETIME NOT NULL,\\n    chief_complaint TEXT,\\n    diagnosis TEXT,\\n    treatment_plan TEXT,\\n    vital_signs JSON, -- Store BP, temperature, pulse, etc.\\n    prescription_id INT,\\n    follow_up_date DATE,\\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\\n    FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE,\\n    FOREIGN KEY (doctor_id) REFERENCES staff(staff_id) ON DELETE CASCADE,\\n    FOREIGN KEY (appointment_id) REFERENCES appointments(appointment_id) ON DELETE SET NULL,\\n    INDEX idx_patient_records (patient_id, visit_date),\\n    INDEX idx_visit_date (visit_date)\\n);\\n\\n-- 7. Prescriptions table\\nCREATE TABLE prescriptions (\\n    prescription_id INT PRIMARY KEY AUTO_INCREMENT,\\n    record_id INT NOT NULL,\\n    patient_id INT NOT NULL,\\n    doctor_id INT NOT NULL,\\n    prescription_date DATETIME DEFAULT CURRENT_TIMESTAMP,\\n    FOREIGN KEY (record_id) REFERENCES medical_records(record_id) ON DELETE CASCADE,\\n    FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE,\\n    FOREIGN KEY (doctor_id) REFERENCES staff(staff_id) ON DELETE CASCADE,\\n    INDEX idx_patient_prescriptions (patient_id, prescription_date)\\n);\\n\\n-- 8. Prescription Details table\\nCREATE TABLE prescription_details (\\n    detail_id INT PRIMARY KEY AUTO_INCREMENT,\\n    prescription_id INT NOT NULL,\\n    medicine_id INT NOT NULL,\\n    dosage VARCHAR(50),\\n    frequency VARCHAR(50),\\n    duration VARCHAR(50),\\n    instructions TEXT,\\n    FOREIGN KEY (prescription_id) REFERENCES prescriptions(prescription_id) ON DELETE CASCADE,\\n    INDEX idx_prescription_details (prescription_id)\\n);\\n\\n-- 9. Medicines table\\nCREATE TABLE medicines (\\n    medicine_id INT PRIMARY KEY AUTO_INCREMENT,\\n    medicine_name VARCHAR(100) NOT NULL,\\n    generic_name VARCHAR(100),\\n    category VARCHAR(50),\\n    manufacturer VARCHAR(100),\\n    unit_price DECIMAL(10,2),\\n    stock_quantity INT DEFAULT 0,\\n    reorder_level INT DEFAULT 50,\\n    expiry_date DATE,\\n    INDEX idx_medicine_name (medicine_name),\\n    INDEX idx_stock (stock_quantity)\\n);\\n\\n-- 10. Lab Tests table\\nCREATE TABLE lab_tests (\\n    test_id INT PRIMARY KEY AUTO_INCREMENT,\\n    test_name VARCHAR(100) UNIQUE NOT NULL,\\n    test_category VARCHAR(50),\\n    normal_range VARCHAR(100),\\n    unit VARCHAR(20),\\n    cost DECIMAL(10,2)\\n);\\n\\n-- 11. Lab Results table\\nCREATE TABLE lab_results (\\n    result_id INT PRIMARY KEY AUTO_INCREMENT,\\n    patient_id INT NOT NULL,\\n    test_id INT NOT NULL,\\n    doctor_id INT,\\n    technician_id INT,\\n    test_date DATETIME NOT NULL,\\n    result_value VARCHAR(100),\\n    result_status ENUM('normal', 'abnormal', 'critical') DEFAULT 'normal',\\n    remarks TEXT,\\n    report_file_path VARCHAR(255),\\n    FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE,\\n    FOREIGN KEY (test_id) REFERENCES lab_tests(test_id) ON DELETE CASCADE,\\n    FOREIGN KEY (doctor_id) REFERENCES staff(staff_id) ON DELETE SET NULL,\\n    FOREIGN KEY (technician_id) REFERENCES staff(staff_id) ON DELETE SET NULL,\\n    INDEX idx_patient_tests (patient_id, test_date),\\n    INDEX idx_test_date (test_date)\\n);\\n\\n-- 12. Billing table\\nCREATE TABLE billing (\\n    bill_id INT PRIMARY KEY AUTO_INCREMENT,\\n    patient_id INT NOT NULL,\\n    bill_date DATETIME DEFAULT CURRENT_TIMESTAMP,\\n    total_amount DECIMAL(12,2) NOT NULL,\\n    paid_amount DECIMAL(12,2) DEFAULT 0,\\n    payment_status ENUM('pending', 'partial', 'paid') DEFAULT 'pending',\\n    payment_method VARCHAR(50),\\n    insurance_claim_amount DECIMAL(12,2) DEFAULT 0,\\n    notes TEXT,\\n    FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE,\\n    INDEX idx_patient_bills (patient_id, bill_date),\\n    INDEX idx_payment_status (payment_status)\\n);\\n\\n-- 13. Bill Details table\\nCREATE TABLE bill_details (\\n    detail_id INT PRIMARY KEY AUTO_INCREMENT,\\n    bill_id INT NOT NULL,\\n    service_type ENUM('consultation', 'procedure', 'lab_test', 'medicine', 'room', 'other') NOT NULL,\\n    service_id INT,\\n    service_description VARCHAR(200),\\n    quantity INT DEFAULT 1,\\n    unit_price DECIMAL(10,2),\\n    total_price DECIMAL(10,2),\\n    FOREIGN KEY (bill_id) REFERENCES billing(bill_id) ON DELETE CASCADE,\\n    INDEX idx_bill_details (bill_id)\\n);\\n\\n-- 14. Rooms table\\nCREATE TABLE rooms (\\n    room_id INT PRIMARY KEY AUTO_INCREMENT,\\n    room_number VARCHAR(20) UNIQUE NOT NULL,\\n    room_type ENUM('general', 'private', 'icu', 'operation_theater', 'emergency') NOT NULL,\\n    floor INT,\\n    building VARCHAR(50),\\n    bed_count INT DEFAULT 1,\\n    occupied_beds INT DEFAULT 0,\\n    rate_per_day DECIMAL(10,2),\\n    status ENUM('available', 'occupied', 'maintenance') DEFAULT 'available',\\n    INDEX idx_room_status (status),\\n    INDEX idx_room_type (room_type)\\n);\\n\\n-- 15. Admissions table\\nCREATE TABLE admissions (\\n    admission_id INT PRIMARY KEY AUTO_INCREMENT,\\n    patient_id INT NOT NULL,\\n    room_id INT NOT NULL,\\n    doctor_id INT NOT NULL,\\n    admission_date DATETIME NOT NULL,\\n    expected_discharge_date DATE,\\n    actual_discharge_date DATETIME,\\n    admission_reason TEXT,\\n    status ENUM('active', 'discharged') DEFAULT 'active',\\n    FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE,\\n    FOREIGN KEY (room_id) REFERENCES rooms(room_id) ON DELETE CASCADE,\\n    FOREIGN KEY (doctor_id) REFERENCES staff(staff_id) ON DELETE CASCADE,\\n    INDEX idx_active_admissions (status, admission_date),\\n    INDEX idx_patient_admissions (patient_id, admission_date)\\n);\\n\\n-- 16. Inventory table\\nCREATE TABLE inventory (\\n    inventory_id INT PRIMARY KEY AUTO_INCREMENT,\\n    item_name VARCHAR(100) NOT NULL,\\n    category VARCHAR(50),\\n    quantity INT DEFAULT 0,\\n    unit VARCHAR(20),\\n    reorder_level INT,\\n    supplier_id INT,\\n    last_restocked DATE,\\n    INDEX idx_category (category),\\n    INDEX idx_quantity (quantity)\\n);\\n\\n-- Create views for common queries\\nCREATE VIEW active_appointments AS\\nSELECT \\n    a.appointment_id,\\n    p.first_name AS patient_first_name,\\n    p.last_name AS patient_last_name,\\n    s.first_name AS doctor_first_name,\\n    s.last_name AS doctor_last_name,\\n    a.appointment_date,\\n    a.appointment_time,\\n    a.reason_for_visit\\nFROM appointments a\\nJOIN patients p ON a.patient_id = p.patient_id\\nJOIN staff s ON a.doctor_id = s.staff_id\\nWHERE a.status = 'scheduled' \\n  AND a.appointment_date >= CURRENT_DATE;\\n\\nCREATE VIEW patient_summary AS\\nSELECT \\n    p.patient_id,\\n    p.mrn,\\n    CONCAT(p.first_name, ' ', p.last_name) AS full_name,\\n    p.date_of_birth,\\n    TIMESTAMPDIFF(YEAR, p.date_of_birth, CURDATE()) AS age,\\n    p.gender,\\n    p.blood_group,\\n    COUNT(DISTINCT a.appointment_id) AS total_appointments,\\n    COUNT(DISTINCT mr.record_id) AS total_visits\\nFROM patients p\\nLEFT JOIN appointments a ON p.patient_id = a.patient_id\\nLEFT JOIN medical_records mr ON p.patient_id = mr.patient_id\\nGROPP BY p.patient_id;\",\n  \"database_specific_notes\": \"MySQL/MariaDB:\\n- Uses AUTO_INCREMENT for primary keys\\n- ENUM types for predefined values\\n- JSON column type for vital_signs (MySQL 5.7+)\\n- ON UPDATE CURRENT_TIMESTAMP for automatic timestamp updates\\n\\nPostgreSQL adaptations needed:\\n- Replace AUTO_INCREMENT with SERIAL\\n- Replace ENUM with CHECK constraints or custom types\\n- Use JSONB instead of JSON for better performance\\n- Replace CURRENT_TIMESTAMP with NOW()\\n- Use GENERATED ALWAYS AS for computed columns\\n\\nSQL Server adaptations:\\n- Replace AUTO_INCREMENT with IDENTITY(1,1)\\n- Replace ENUM with CHECK constraints\\n- Use NVARCHAR instead of VARCHAR for Unicode support\\n- Replace LIMIT with TOP\\n- Use GETDATE() instead of CURRENT_TIMESTAMP\\n\\nOracle adaptations:\\n- Use SEQUENCES instead of AUTO_INCREMENT\\n- Replace ENUM with CHECK constraints\\n- VARCHAR2 instead of VARCHAR\\n- NUMBER instead of INT/DECIMAL\\n- Use SYSDATE for current timestamp\",\n  \"performance_recommendations\": [\n    \"Primary indexes created on all ID columns for fast lookups\",\n    \"Composite indexes on frequently queried combinations (patient_id + date)\",\n    \"Unique constraints prevent duplicate appointments at same time\",\n    \"Consider partitioning large tables (medical_records, lab_results) by date for databases over 1TB\",\n    \"Add full-text search indexes on diagnosis and treatment_plan columns if needed\",\n    \"Create materialized views for complex reporting queries\",\n    \"Implement table partitioning for billing and medical_records tables by year\",\n    \"Consider using Redis for caching frequently accessed patient data\",\n    \"Set up regular index maintenance jobs (ANALYZE/OPTIMIZE TABLE)\",\n    \"Monitor slow query logs and create additional indexes as needed\"\n  ],\n  \"alternative_approaches\": \"1. NoSQL Alternative (MongoDB):\\n   - Store patient records as documents with embedded medical history\\n   - Better for unstructured medical data and images\\n   - Easier horizontal scaling\\n\\n2. Hybrid Approach:\\n   - Use PostgreSQL for transactional data\\n   - Use MongoDB for medical images and unstructured notes\\n   - Use Redis for session management and caching\\n   - Use Elasticsearch for full-text search on medical",
    "model": "claude-opus-4-20250514",
    "output_tokens": 4096,
    "input_tokens": 767
}